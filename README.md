# 背景
射电干涉阵成像，是通过利用阵列中各个射电望远镜接收并测量自身所在位置的电场，再综合望远镜所采集到的数据，对天空的亮度分布（天图）进行重建的过程。

要进行干涉测量，需要保证信号是被准确地采集的，例如各个观测站点必须同时(注：这个"同时"指经典的"同时"。)以同样的模式进行采集。

假设天球（关于天球的部分，请查阅同目录下的`CelestialSphere.md`）上存在一个射电源，这个源将持续地辐射电磁波，并被位于地球上的台站所接收。
各个台站接收到的源电场信号将会由于光的传播而存在由源的方向矢量$(l, m, \sqrt{1-l^2-m^2})$和台站的位置共同决定的时间延迟。

<center>
	<img src="https://img.illya.club/upload/2019/06/28/20190628174639-79ca6e2b.png" title="台站接收平行光，由相对位置引入的延迟" />
</center>
<br></br>

进一步地说，台站间接收同一个电场信号的相对时间延迟，是由$(l, m, \sqrt{1-l^2-m^2})$和台站间相对位置（基线）$(u, v, w)$共同决定的。

$$

\left[
	\begin{matrix}
		u_1 & v_1 & w_1 \\
		u_2 & v_2 & w_2 \\
		u_3 & v_3 & w_3
	\end{matrix}
\right]
*
\left[
	\begin{matrix}
		x \\
		y \\
		z
	\end{matrix}
\right]
=
\left[
	\begin{matrix}
		\tau_1 \\
		\tau_2 \\
		\tau_3
	\end{matrix}
\right]
*
c

$$

这部分大作业的目标是，模拟生成由观测台站接收的信号。
其中：
1. 射电源辐射的信号是标准正态分布的随机数的某一个频段，频段由中心频率和带宽来决定(见`bandwidth.csv`)，在模拟获取对应数据的过程中需要使用滤波器;
2. 定义采样率和采样时间(`sample.csv`)、光速(`speed_of_light.csv`)、源相关参数(`sources.csv`)和台站相关参数(`stations.csv`)，可以得到各个台站接收的各个源辐射的电场，而实际接收的电场则是由这些单独的电场叠加得到；
3. 同时各个台站启动采集的时间有偏差，因此总的收集的信号存在额外的时间偏移，台站们时间偏移的分布是高斯分布，分布的标准差被定义在(`ostrength.csv`)；
4. 对各个台站理想情况下采集到的信号施加3.中提到的随机的时间偏移，就得到的模拟采集的结果；
5. 从 -0.5s 开始，1号台站(0, 0, 0)开始接收到各个源辐射的信号。

参考书:    
《信号与系统》[傅里叶变换、数字滤波器]    
《Synthesis Imaging in Radio Astronomy II》    

# 作业要求（功能部分）

## Makefile

本次作业提供了 Makefile，最终助教也将使用 Makefile 进行测试。需要注意，你在编写所有程序文件时，都应该使用 make 给程序传入的参数（来自 `sys.argv`），而非硬编码下面提到的任何文件名或通道编号等信息；否则，你可能无法通过测试。

## 基本要求

作业功能部分（占80分）的基础要求分成以下几个部分，完成各个任务即可拿到相应分数

|    任务（程序名）     | 分数 |
| --------------------- | ---- |
| oscillation.py        | 30   |
| random_offset.py      | 10   |
| plot_wave.py          | 10   |
| plot_wave_spectrum.py | 10   |
| superimpose.py        | 20   |

1. oscillation.py</br>
本部分实验通过读取`sources.csv, stations.csv, bandwidth.csv, speed_of_light.csv, sample.csv`文件中的配置，来生成理想情况下的数据。
最终需要生成：
	1. 从-0.5s开始，给定长度和采样率的台站接收的波形数据； (20 pt)
	2. 从-0.5s开始，给定长度和采样率下各个源由1号台站（定义在`stations.csv`中，坐标是(0, 0, 0)）分别接收的信号波形数据。(10 pt)
<br>**例如：sample.csv中定义采样时间为3s时，你生成的数据对应的时间应为[-0.5, 2.5)s。**
<br>**-0.5s不会影响本题的结果，除非你愿意为信号加上时间戳，但它会影响之后的部分任务。**
<br>生成的数据保存在文件'waves.h5'中。

2. random_offset.py</br>
本实验通过读取`ostrength.csv`来计算台站时间延迟的随机数。    
最终得到各个台站各自的随机时间偏移，保存在`offset.csv`中。

3. plot_wave.py</br>
读取`waves.h5 sample.csv`, 画出信号的时域波形。
其中包括：
	1. 1号源在1号台站处的[0, 2)$\mu s$ 的时域波形;
	2. 2号源在1号台站处的[0, 2)$\mu s$ 的时域波形;
	3. 3号源在1号台站处的[0, 2)$\mu s$ 的时域波形;
	4. 1号台站的[0, 2)$\mu s$ 的时域信号。</br>
它们应当按照顺序[左上->右上->左下->右下]地布置在一张图片中，并有必要的标题和标注，其中横坐标单位为$\mu s$。

4. plot_wave_spectrum.py</br>
读取`waves.h5 sample.csv`, 画出信号的频域波形，只需要幅度谱。
图中需要包括：
	1. 1号源在1号台站处的[0, 2)$\mu s$ 的幅度谱;
	2. 2号源在1号台站处的[0, 2)$\mu s$ 的幅度谱;
	3. 3号源在1号台站处的[0, 2)$\mu s$ 的幅度谱;
	4. 1号台站的[0, 2)$\mu s$ 的幅度谱。</br>
它们应当按照顺序[左上->右上->左下->右下]地布置在一张图片中，并有必要的标题和标注，其中横坐标单位为Hz。

5. superimpose.py</br>
读取`waves.h5 offset.csv`, 生成由理想状态的信号在`offset.csv`中定义的时间偏移下得到的模拟结果。    
最终需要得到各个台站接收的信号中[0, 2)s 的部分，保存在`signal.h5`文件中。

## 提高要求
提高要求为加分项，至多可加 20 分。你可以自由发挥，一些可选项为：

	1. 在程序运行过程中输出友好的提示信息（如处理进度）
	2. 增强程序的鲁棒性，添加完善的错误处理（如文件格式不正确、不存在文件等）
	3. 让程序可以自如地生成任意规模的数据，而不需要增加太多代码
	4. 增加程序运行的效率

如果你实现了任何提高要求，请在实验报告中详细说明你的工作，这将作为评分的依据。
